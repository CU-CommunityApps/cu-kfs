<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
           xmlns:p="http://www.springframework.org/schema/p"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
    <!-- Our CUWebAuthAuthenticationService is a RemoteUserAuthenticationService subclass that can 
         also look at the HTTP headers that CUWebAuth exposes -->
    <bean id="kimAuthenticationService" class="edu.cornell.cynergy.service.impl.CUWebAuthAuthenticationService">
        <property name="useHttpHeaders"><value>${cynergy.cuwal.useHttpHeaders}</value></property>
    </bean>
    
  
    <!-- override encryption services  -->
         <bean id="encryptionService" class="edu.cornell.cynergy.service.impl.AESEncryptionServiceImpl" lazy-init="true">
          <property name="key" value="${cynergy.encryption.key}"/>
          <property name="enabled" value="${cynergy.encryption.busEncryption}"/>
        </bean> 
         
        <!-- moved from cynergy-server-customizations/CynergyKSBSpringBeans.xml and  cynergy-server-customizations/CynergyKEWSpringBeans.xml -->
        <bean id="enEncryptionService" class="edu.cornell.cynergy.service.impl.AESEncryptionServiceImpl" lazy-init="true">
                <property name="key" value="${cynergy.encryption.key}"/>
          <property name="enabled" value="${cynergy.encryption.busEncryption}"/>
        </bean> 
      
    <bean id="enNoteService" class="org.kuali.rice.kew.notes.service.impl.NoteServiceImpl">
                <property name="noteDAO" ref="enNoteDAO" />
                <property name="attachmentService">
                        <bean class="org.kuali.rice.kew.notes.service.impl.AttachmentServiceImpl">
                                <property name="attachmentDir" value="${attachment.dir.location}" />
                        </bean>
                </property>
                <property name="antiVirusService">
                        <ref bean="${cynergy.antivirus.service}" />
                </property>
        </bean>
        
        <bean id="attachmentService" class="org.kuali.rice.kns.service.impl.AttachmentServiceImpl">
                <property name="kualiConfigurationService">
                        <ref bean="kualiConfigurationService" />
                </property>
                <property name="attachmentDao">
                        <ref bean="attachmentDao" />
                </property>
                <property name="antiVirusService">
                        <ref bean="${cynergy.antivirus.service}" />
                </property>
        </bean>
        
        <bean id="dummyAntiVirusService" class="edu.cornell.cynergy.antivirus.service.DummyAntiVirusServiceImpl" />
        
        <bean id="antiVirusService" class="edu.cornell.cynergy.clamav.ClamAVService">
                <property name="host" value="127.0.0.1" />
                <property name="port" value="3310" />
                <property name="timeout" value="60000" />
        </bean>

        <bean id="UserOptionsServiceInner" class="org.kuali.rice.kew.useroptions.UserOptionsServiceImpl" lazy-init="true">
       <property name="userOptionsDAO">
           <ref bean="enUserOptionsDAO" />
       </property>
       <property name="reloadActionListDAO">
           <ref bean="reloadActionListDAO" />
       </property>
       <property name="lastLoginTimeDAO">
            <ref bean="lastLoginTimeDAO" />
        </property>
    </bean>
   
   <!-- CYNERGY-2210: Added the "reloadActionListDAO" bean needed for the "RELOAD_ACTION_LIST" fix. -->
    <bean id="reloadActionListDAO" class="org.kuali.rice.kew.useroptions.dao.impl.ReloadActionListDaoJdbcImpl">
        <constructor-arg>
            <ref bean="kewNonTransactionalDataSource"/>
        </constructor-arg>
    </bean>
    
    <!-- CYNERGY-2365: Added a new "lastLoginTimeDAO" bean for tracking each user's most recent login. -->
    <bean id="lastLoginTimeDAO" class="edu.cornell.cynergy.kew.useroptions.dao.impl.LastLoginTimeDaoJdbcImpl">
        <constructor-arg>
            <ref bean="kewNonTransactionalDataSource"/>
        </constructor-arg>
    </bean>
   
   <bean id="abstractDataSourceBase" abstract="true"> 
        <property name="driverClassName" value="${rice.server.datasource.driver.class}"/> 
        <property name="validationQuery" value="${rice.server.datasource.validating.query}"/> 
        <property name="url" value="${rice.server.datasource.url}"/> 
        <property name="username" value="${rice.server.datasource.username}" /> 
        <property name="password" value="${rice.server.datasource.password}" /> 
</bean> 

    <bean id="kewNonTransactionalDataSource" parent="abstractDataSourceBase" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"> 
        <property name="maxActive" value="${rice.server.datasource.pool.size}"/> 
        <property name="minIdle" value="5" /> 
        <property name="initialSize" value="5"/> 
        <property name="accessToUnderlyingConnectionAllowed" value="true"/> 
    </bean> 
    
    
    <!-- KFSPTS-1735 -->
    <bean id="documentService" class="edu.cornell.kfs.sys.document.service.impl.CUFinancialSystemDocumentServiceImpl">
                <property name="documentDao">
                        <ref bean="documentDao" />
                </property>
                <property name="documentHelperService">
                <ref bean="documentHelperService" />
                </property>
                <property name="dateTimeService">
                        <ref bean="dateTimeService" />
                </property>
                <property name="workflowDocumentService">
                        <ref bean="workflowDocumentService" />
                </property>
                <property name="kualiRuleService">
                        <ref bean="kualiRuleService" />
                </property>
                <property name="documentHeaderService">
                        <ref bean="documentHeaderService" />
                </property>
                <property name="businessObjectService">
                        <ref bean="businessObjectService" />
                </property>
                <property name="maintenanceDocumentService">
                        <ref bean="maintenanceDocumentService" />
                </property>
                <property name="noteService">
                        <ref bean="noteService" />
                </property>
                <property name="dataDictionaryService">
                        <ref bean="dataDictionaryService" />
                </property>
        </bean> 

    <!-- We override the KFS impl so that we can read properties specified at runtime -->
<!--
           <bean id="properties" class="edu.cornell.kfs.sys.context.PropertyLoadingFactoryBean" />
          <bean id="securityProperties" class="edu.cornell.kfs.sys.context.PropertyLoadingFactoryBean"
            p:secureMode="true" />
              -->
              
    <!-- 
      Bringing the identity service overrides into KFS is not the preferred solution...
    <import resource="classpath*:edu/cornell/cynergy/core/CynergyServerOverrideSpringBeans.xml"/>
     -->
</beans>